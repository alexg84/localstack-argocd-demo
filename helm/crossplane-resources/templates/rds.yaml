apiVersion: rds.aws.crossplane.io/v1alpha1
kind: DBInstance
metadata:
  name: {{ .Values.rds.dbName }}
spec:
  forProvider:
    region: {{ .Values.localstack.region }}
    dbInstanceClass: {{ .Values.rds.instanceClass }}
    dbName: {{ .Values.rds.dbName }}
    engine: {{ .Values.rds.engine }}
    engineVersion: {{ .Values.rds.engineVersion | quote }}
    masterUsername: admin
    masterUserPasswordSecretRef:
      name: db-password
      key: password
      namespace: default
    allocatedStorage: {{ .Values.rds.allocatedStorage }}
    storageType: gp2
    publiclyAccessible: true
    skipFinalSnapshot: true
    deleteAutomatedBackups: true
  providerConfigRef:
    name: localstack-config
---
apiVersion: v1
kind: Secret
metadata:
  name: db-password
  namespace: default
type: Opaque
data:
  password: cGFzc3dvcmQxMjM=  # base64 encoded "password123"
